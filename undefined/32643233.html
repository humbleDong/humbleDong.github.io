<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SpringBoot监控与报警 | 七岁就很浪</title><meta name="keywords" content="SpringBoot3"><meta name="author" content="小东"><meta name="copyright" content="小东"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SpringBoot监控与报警"><meta name="application-name" content="SpringBoot监控与报警"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot监控与报警"><meta property="og:url" content="https://humbledong.github.io/undefined/32643233.html"><meta property="og:site_name" content="七岁就很浪"><meta property="og:description" content="SpringBoot监控与报警Spring Boot  Actuator概述启用SpringBoot Actuator功能，只需要添加其启动器依赖即可，如下面的依赖配置所示。 1234&amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.b"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://s2.loli.net/2024/01/08/DBhgJApORaw1FXi.webp"><meta property="article:author" content="小东"><meta property="article:tag" content="七岁就很浪博客"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2024/01/08/DBhgJApORaw1FXi.webp"><meta name="description" content="SpringBoot监控与报警Spring Boot  Actuator概述启用SpringBoot Actuator功能，只需要添加其启动器依赖即可，如下面的依赖配置所示。 1234&amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.b"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://humbledong.github.io/undefined/32643233"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🧑‍💻 IT行业从业者","🔍 分享与热心帮助","🐟️ 授人以渔不以鱼","🎹 捕捉人间好音乐"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 小东","link":"链接: ","source":"来源: 七岁就很浪","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '七岁就很浪',
  title: 'SpringBoot监控与报警',
  postAI: '',
  pageFillDescription: 'SpringBoot监控与报警, Spring Boot  Actuator概述, Endpoints（端点）, 概述, 内置端点, 启用端点, 暴露端点, 端点安全性, 自定义端点映射, 端点实现机制, 自定义端点, loggers（日志端点）, Observability（可观测性Spring Boot 3.0+）, Metrics（指标）, 内置指标, 自定义指标, Traces（链路跟踪SpringBoot3.0+）, 概述, 链路跟踪环境搭建（zipkin）, 链路跟踪x2F展示, Spring Boot Admin, 概述, 环境搭建, 1.	搭建Spring Boot Admin Server, 2.	搭建Spring Boot Admin Client, 3.	监控页面, 首页菜单, 细节菜单, 性能菜单, 环境菜单, 类菜单, 配置属性菜单, 计划任务菜单, 日志配置菜单, JVM菜单, 映射菜单, 缓存菜单, 4.	监控报警, 浏览器通知, 邮件通知, 总结, Prometheus+Grafana监控与报警概述启用功能只需要添加其启动器依赖即可如下面的依赖配置所示具体导入的依赖如下它主要包含了相关依赖包和自动配置模块端点概述端点用来监控应用并与之交互内置了许多端点开箱即用每个端点都可以通过或者的方式暴露出去但绝大多数情况下端点都是以方式暴露的每个端点都会被映射为方式即端点的比如健康端点为既然端点是以方式暴露的那么就可以通过来访问这个端点该端点返回了状态表示应用为健康运行状态内置端点应用的还添加了的内置端点启用端点除了端点其他所有端点默认都是启用的也可以启用或禁用某个端点启用或禁用某个端点是通过参数配置的比如启用端点如果想一个个手动启用端点则可以先禁用全部端点再启用某个端点这里先禁用所有端点然后只启用端点需要注意的是被禁用的端点会完全从上下文中删除如果只想更改端点暴露的方式那么可以使用和配置参数替代禁用端口的方式暴露端点端点被启用后并不一定能够被访问还要看端点是否被暴露并且暴露的方式是怎么样的因为端点可能包含敏感信息所以需要谨慎暴露相关端点默认以暴露了所有端点处于安全考虑方式则只暴露了端点开始默认和都只暴露端点更加严格和安全暴露端点方式这里配置了以方式只暴露和端点以方式暴露除以外的所有端点两种暴露方式是独立的不会互相影响各自暴露的端点如果同一种暴露方式同时配置了和则以配置的优先端点安全性端点提供的信息可能涉及敏感性所以除了谨慎暴露所需要的端点还需要对端点进行安全保护如提供对应的访问权限等等这里就要使用配合使用了只要由类库依赖就会自动保护所有接口还包括除健康端点外的所有端点具体的实现见的自动配置类导入启动器应用重启后再访问应用的端点如果没有登录授权则默认会跳到登录页面需要输入默认的用户信息才能继续访问端点如果不想使用自动配置的默认机制可以注册一个实现自定义安全机制端点授权配置需要用到类这里配置了只有需要角色才可以访问其他接口的和端点不需要授权都能正常访问然后创建了两个授权用户表示明文密码只有用户才拥有角色输入其他用户就会返回错误自定义端点映射默认情况下通过跟路径可以显示所有暴露出来的端点这样不是很安全可以通过以下配置禁用还可以更改默认的端点映射因为默认的端点的前缀和端点所有人都知道不是很安全可以通过配置更改端点默认的前缀和端点这里把默认的端点前缀映射从改为把健康端点更名为另外端点映射的地址和端口也可以更改默认和应用共享一个可以把端点独立出来和是配套使用的不是必需品这里就可以看到日志启动了两个这样应用的端口和端点管理端口分开了既然分开了那么管理端点的要开启访问就需要通过自己的系列参数控制另外把端点改为还能禁止以的方式暴露所有端点和以方式排除暴露端点是一样的所以通过关闭显示所有端点的页面和更改默认的端点映射与端口也能起到保护端点安全的目的端点实现机制内置端点一旦启用就会自动配置比如端点的自动配置类为源码自动配置类是空的其实是通过注解导入了不同类型的端点配置类根据这个自动配置命名规则可以很容易找到其他端点的自动配置类以及端点类端点自动配置类都被注册到了新的配置文件中端点具体的实现类命名规则为比如健康端点的实现类部分源码端点实现类通过一个注解修饰并且需要注册为中的在应用中支持和两种暴露方式也支持和注解以不同的方式暴露还可以通过和注解扩展现有的端点通过在方法上定义不同的操作注解以实现不同方法与应用交互支持的操作注解如下表操作注解方法如果端点中定义了两个注解说明这个端点只支持方法的请求一个不带参数另一个通过注解绑定路径上的参数自定义端点了解的端点的视线机制下面实现自定义的端点这里创建了一个端点类并通过注册到中暴露了以方式访问端点类提供了两个方法用户获取用户信息和更新用户信息端点为由于等端点注解的参数默认是所以新建的端点默认是启用状态不需要额外配置虽然注解允许暴露为方式但并未真正开启暴露前面我们把方式暴露为了这里就不配置了后面的是通过注解绑定到路径上的参数默认只绑定单个参数如果要绑定多个则可以指定匹配路径上的所有参数如果发起一个请求那么直接返回错误这是因为默认会开启跨站请求伪造保护机制如果不是基于浏览器的应用则建议关闭保护机制关闭案例或者只对端点映射关闭保护机制关闭后再重启应用再用方法调用即可如果端点类操作方法定义了参数则参数不能为空否则返回错误通过在方法参数上加注解就可以允许参数为空另外端点也支持跨域调用如以下跨域配置这样就可以语序来自网站的方法请求了这两个也支持通配符日志端点提供了一个日志端点对应的端点类核心源码如下日志端点提供了两个读和一个写操作可以查看正在运行的应用的日志级别设置也可以动态调整某个包的日志级别该端点默认不会暴露需要自行暴露获取日志端点信息日志端点支持设置的日志级别有恢复默认设置日志端点目前只能用来查看和更新包的日志级别以及查看所有的日志分组但不支持查看和更新复杂的日志配置可观测性可观测性是指从系统外部观测正在运行的系统内部的状态的能力主要是由以下三大组件组成日志记录度量指标链路跟踪日志就是指平常的日志输出对于指标和跟踪使用的是如果要创建自己的则可以注入一个并使用它添加对应的数据执行观测时的业务逻辑开始执行业务逻辑核心创建一个但不会马上启动观测指定低基数的标签它们将被添加到和中指定高基数的标签它将被添加到中开始执行当前观测并传入一个线程用于执行业务逻辑方法接收一个线程参数源码如下他主要由以下几个过程组成打开打开一个调用线程方法关闭如果有错误则向观测对象发出错误信号停止现在改造一下首页接口让首页执行观测注入并调用其方法开始执行观测然后会记录首页观测到的相关标签数据可以在链路跟踪中查找并且展示具体效果见后续的链路跟踪指标内置指标内置了各种技术的指标的实现比如等通过指标端点可以显示所有应用收集到的指标此端点默认是不暴露的需要自行暴露另外可以通过查看详细指标信息比如通过路径查看最大内存自定义指标如果提供的指标不符合要求则可以通过注册多个实现多个自定义指标比如这里创建了两个指标通过或者端点可以验证指标是否被收集然后获取该指标的信息链路跟踪概述为提供了依赖管理和自动配置是当前比较流行的跟踪类库门面为以下链路跟踪解决方案提供了自动配置使用结合或者使用结合或者是的一个可观测性项目旨在提供可观测性领域的标准化方案解决观测数据的数据模型采集处理导出等的标准化问题提供与三方无关的服务是基于的分布式追踪系统用于收集和查找来自分布式系统的数据链路跟踪环境搭建这里以为例子下载地址然后把下载好的包放到自己的目录下进入编辑器终端执行下载好的包安装并运行后访问导入依赖将桥接到向报告调用链路跟踪信息添加采样参数默认情况下仅对的请求进行采样以防止跟踪导致后端系统不堪重负这里为了便于测试将采样参数设置为即对所有请求都采样如果需要在日志中展示和可以这样设置链路跟踪一次请求完整链路的唯一标识由一组单元组成的一个树状结构基本工作单元每条链路都有不同的组成链路跟踪展示链路跟踪环境搭建好及启动之后再启动应用并发起接口调用会为请求创建一个观测它桥接到然后通过向报告每个链路的跟踪数据再可观性中已经为首页实现了自定义的观测并记录了相关标签数据现在调用接口可以看到三此请求的链路随便点击一条进入详细链路可以看到首页观测记录及携带的和标签数据后台也记录了调用链路跟踪日志可以看到一条链路输出了两条日志也就是在首页方法中输出的两条日志其中相同不同概述用于管理和监控应用它并不是官方提供的而是某个社区开源的开源官网显示的主要功能如下显示应用程序的监控状态应用程序上下线监控查看线程信息可视化的查看日志以及下载日志文件动态切换日志级别请求信息跟踪其他功能点包括和即应用以的方式向注册应用则通过等注册中心进行注册只是基于端点之上的应用环境搭建集成需要先搭建再搭建用于收集的健康数据并进行监控报警搭建导入依赖还需要模块这里在总的中就不引入了在启动类上添注解以启用搭建导入依赖然后添加以下配置核心参数说明如下指定需要注册的地址开始默认只暴露健康端点这里全部暴露了在生产环境中需谨慎选择的信息默认是禁用的这里开启然后禁用所有安全机制让所有端点都可以被访问配置如下这里为了测试先禁用了所有安全措施确保所有端点都可以被访问不然无法被监控到实际项目中可自行设置安全性项目配置完毕后先启动服务端在启动客户端即可监控页面打开控制台首页菜单服务端和客户端都运行成功了单击对应的项目可以看到更多的细节细节菜单细节菜单中展示了一些健康相关信息这些信息有助于开发者掌握应用的健康状况性能菜单环境菜单类菜单类菜单中有所有容器中的以及是否是单例配置属性菜单配置属性菜单显示所有的配置参数计划任务菜单现在去写一个计划任务重新启动一下客户端我是一个每十秒执行的任务用来查看计划任务菜单这里只能展示任务信息及状态不可以进行控制日志配置菜单日志配置菜单中显示所有类的日志级别并能修改某个类的日志级别默认情况下日志文件无法通过日志端点访问需要在客户端应用配置或者参数来启用端点再重启应用就可以看到日志文件的内容了菜单菜单可以显示当前所有线程堆栈堆栈并能进行下载分析映射菜单可以显示所有映射缓存菜单显示所有缓存这里不仅可以展示还可以清除和管理缓存用于管理和监控应用具体就是通过客户端暴露的各种端点和指标实现的并在此基础上进行了一些包装和展示监控报警浏览器通知现在把客户端停掉若干秒后页面会自动刷新离线实例显示应用出现在离线实例中了如果浏览器没有禁用通知那么同时会发出应用上线下线的通知我这里是禁用了的在自动配置类中注册了一个状态变更触发器源码如下默认每秒会检测一下实例的状态如果需要修改检测时间间隔那么可以参考和参数配置类进行配置邮件通知在项目中导入邮件启动器配置及收件人信息发件人收件人抄送人简单配置好了发件人收件人和抄送人后即可尝试去启动和退出后等待邮箱消息从服务端的控制台可以看到服务端无法连接到客户端应用的异常日志邮件也会收到这样的内容从邮件的内容中可以看到应用实例下线的相关信息为了防止敏感信息泄露内置的默认邮件模版不会实例任何元数据信息如果有需要则可以自定义模版更多的配置信息可以参考注册的实例源码类源码源码中可所有的显示参数都是可以配置的可以看到邮件通知默认使用的是内置的模版总结监控功能很简单只能监控应用的状态而不能监控中间件的健康状况所以不能替代专业的监控系统比如监控系统组合但至少足够轻量级只需要启动一个服务端应用而不需要太多复杂的组件所以对于那些简单的应用还是够用暂时缺少环境',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-08 15:04:41',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="七岁就很浪" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://s2.loli.net/2024/01/06/tvBb7V3ND9Y6hIc.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">我的</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.cnblogs.com/qisui/" title="博客园"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/blog.ico" alt="博客园"/><span class="back-menu-item-text">博客园</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">常用</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.processon.com/" title="processon画图"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/processon.ico" alt="processon画图"/><span class="back-menu-item-text">processon画图</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">七岁就很浪</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://s2.loli.net/2024/01/06/6TXERj7mhpLnsGB.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/06/6TXERj7mhpLnsGB.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2024/01/06/2TQtWAnv8Of1ykp.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AOF/" style="font-size: 1.05rem;">AOF<sup>1</sup></a><a href="/tags/AOP/" style="font-size: 1.05rem;">AOP<sup>1</sup></a><a href="/tags/Ajax/" style="font-size: 1.05rem;">Ajax<sup>1</sup></a><a href="/tags/Druid/" style="font-size: 1.05rem;">Druid<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>2</sup></a><a href="/tags/IoC/" style="font-size: 1.05rem;">IoC<sup>1</sup></a><a href="/tags/JSON/" style="font-size: 1.05rem;">JSON<sup>1</sup></a><a href="/tags/JSP/" style="font-size: 1.05rem;">JSP<sup>1</sup></a><a href="/tags/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">Java多线程<sup>1</sup></a><a href="/tags/Java%E8%BF%9B%E9%98%B6/" style="font-size: 1.05rem;">Java进阶<sup>2</sup></a><a href="/tags/Linux%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" style="font-size: 1.05rem;">Linux基本命令<sup>1</sup></a><a href="/tags/Linux%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Linux基础<sup>1</sup></a><a href="/tags/Maven/" style="font-size: 1.05rem;">Maven<sup>1</sup></a><a href="/tags/MyBatis-plus/" style="font-size: 1.05rem;">MyBatis-plus<sup>2</sup></a><a href="/tags/MySQL%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">MySQL基础<sup>1</sup></a><a href="/tags/Mybatis/" style="font-size: 1.05rem;">Mybatis<sup>1</sup></a><a href="/tags/RDB/" style="font-size: 1.05rem;">RDB<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>2</sup></a><a href="/tags/Servlet/" style="font-size: 1.05rem;">Servlet<sup>1</sup></a><a href="/tags/Shiro/" style="font-size: 1.05rem;">Shiro<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>1</sup></a><a href="/tags/SpringBoot-CRUD/" style="font-size: 1.05rem;">SpringBoot-CRUD<sup>1</sup></a><a href="/tags/SpringBoot3/" style="font-size: 1.05rem;">SpringBoot3<sup>10</sup></a><a href="/tags/SpringBoot%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">SpringBoot原理<sup>1</sup></a><a href="/tags/SpringMVC/" style="font-size: 1.05rem;">SpringMVC<sup>1</sup></a><a href="/tags/SpringSecurity/" style="font-size: 1.05rem;">SpringSecurity<sup>1</sup></a><a href="/tags/Spring%E4%BA%8B%E5%8A%A1/" style="font-size: 1.05rem;">Spring事务<sup>1</sup></a><a href="/tags/Swagger/" style="font-size: 1.05rem;">Swagger<sup>1</sup></a><a href="/tags/Thymeleaf/" style="font-size: 1.05rem;">Thymeleaf<sup>1</sup></a><a href="/tags/Tomcat/" style="font-size: 1.05rem;">Tomcat<sup>1</sup></a><a href="/tags/Yaml/" style="font-size: 1.05rem;">Yaml<sup>1</sup></a><a href="/tags/cron%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">cron表达式<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/" style="font-size: 1.05rem;">代码生成器<sup>1</sup></a><a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/" style="font-size: 1.05rem;">国际化<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>1</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6task/" style="font-size: 1.05rem;">定时task<sup>1</sup></a><a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">年度总结<sup>1</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5task/" style="font-size: 1.05rem;">异步task<sup>1</sup></a><a href="/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/" style="font-size: 1.05rem;">拦截器<sup>2</sup></a><a href="/tags/%E9%82%AE%E4%BB%B6task/" style="font-size: 1.05rem;">邮件task<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">七月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/SpringBoot3/" itemprop="url">SpringBoot3</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/SpringBoot3/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>SpringBoot3</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SpringBoot监控与报警</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-10-28T06:14:20.000Z" title="发表于 2023-10-28 14:14:20">2023-10-28</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-01-08T07:04:41.797Z" title="更新于 2024-01-08 15:04:41">2024-01-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot监控与报警"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://s2.loli.net/2024/01/08/DBhgJApORaw1FXi.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://humbledong.github.io/undefined/32643233.html"><header><a class="post-meta-categories" href="/categories/SpringBoot3/" itemprop="url">SpringBoot3</a><a href="/tags/SpringBoot3/" tabindex="-1" itemprop="url">SpringBoot3</a><h1 id="CrawlerTitle" itemprop="name headline">SpringBoot监控与报警</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小东</span><time itemprop="dateCreated datePublished" datetime="2023-10-28T06:14:20.000Z" title="发表于 2023-10-28 14:14:20">2023-10-28</time><time itemprop="dateCreated datePublished" datetime="2024-01-08T07:04:41.797Z" title="更新于 2024-01-08 15:04:41">2024-01-08</time></header><h1 id="SpringBoot监控与报警"><a href="#SpringBoot监控与报警" class="headerlink" title="SpringBoot监控与报警"></a>SpringBoot监控与报警</h1><h2 id="Spring-Boot-Actuator概述"><a href="#Spring-Boot-Actuator概述" class="headerlink" title="Spring Boot  Actuator概述"></a>Spring Boot  Actuator概述</h2><p>启用SpringBoot Actuator功能，只需要添加其启动器依赖即可，如下面的依赖配置所示。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体导入的依赖如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/HWModG6q4DvF21s.png" alt="image-20231214094922017"></p>
<p>它主要包含了micrometer相关依赖包和Actuator自动配置模块</p>
<h2 id="Endpoints（端点）"><a href="#Endpoints（端点）" class="headerlink" title="Endpoints（端点）"></a>Endpoints（端点）</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Endpoint端点用来监控SpringBoot应用并与之交互，SpringBoot内置了许多端点，“开箱即用”，每个端点都可以通过Http或者JMX的方式暴露出去，但绝大多数情况下端点都是以HTTP方式暴露的，每个端点都会被映射为&#x2F;actuator&#x2F;${ID}方式，ID即端点的ID，比如健康端点为&#x2F;actuator&#x2F;health。</p>
<p>既然health端点是以HTTP方式暴露的，那么就可以通过HTTP来访问这个端点。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/npmDIUoAOKTLrEj.png" alt="image-20231214095845257"></p>
<p>该端点返回了UP状态，表示应用为健康运行状态。</p>
<h3 id="内置端点"><a href="#内置端点" class="headerlink" title="内置端点"></a>内置端点</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/AudH7E1LMxGzmDP.png" alt="image-20231214101235520"></p>
<p>Web应用的还添加了的内置端点：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/TsJ5h3vUSyDWawI.png" alt="image-20231214101322372"></p>
<h3 id="启用端点"><a href="#启用端点" class="headerlink" title="启用端点"></a>启用端点</h3><p>除了shutdown端点，其他所有端点默认都是启用的，也可以启用或禁用某个端点，启用或禁用某个端点是通过management.endpoint.<id>.enable参数配置的，比如启用shutdown端点：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">shutdown:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>如果想一个个手动启用端点，则可以先禁用全部端点，再启用某个端点：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">info:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>这里先禁用所有端点，然后只启用info端点</p>
<p>需要注意的是，被禁用的端点会完全从Spring上下文中删除，如果只想更改端点暴露的方式，那么可以使用include和excluede配置参数替代禁用端口的方式。</p>
<h3 id="暴露端点"><a href="#暴露端点" class="headerlink" title="暴露端点"></a>暴露端点</h3><p>端点被启用后，并不一定能够被访问，还要看端点是否被暴露，并且暴露的方式是怎么样的。因为端点可能包含敏感信息，所以需要谨慎暴露相关端点。</p>
<p>SpringBoot2.7默认以JMX暴露了所有端点，处于安全考虑，Web方式则只暴露了Health端点。</p>
<p>SpringBoot3开始默认JMX和HTTP都只暴露Health端点。更加严格和安全</p>
<p>暴露端点方式：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">jmx:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">health,info</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">        <span class="attr">exclude:</span> <span class="string">threadump</span></span><br></pre></td></tr></table></figure>

<p>这里配置了以JMX方式只暴露health和info端点，以web方式暴露除threadump以外的所有端点，两种暴露方式是独立的，不会互相影响各自暴露的端点，如果同一种暴露方式同时配置了include和exclude，则以exclude配置的优先。</p>
<h3 id="端点安全性"><a href="#端点安全性" class="headerlink" title="端点安全性"></a>端点安全性</h3><p>端点提供的信息可能涉及敏感性，所以除了谨慎暴露所需要的端点，还需要对端点进行安全保护，如提供对应的访问权限等等。</p>
<p>这里就要使用Spring Security配合使用了。只要由Spring Security类库依赖，SpringBoot就会自动保护所有接口，还包括除health健康端点外的所有端点，具体的实现见Actuator的ManagementWebSecurityAutoConfiguration自动配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(</span></span><br><span class="line"><span class="meta">    before = &#123;SecurityAutoConfiguration.class&#125;,</span></span><br><span class="line"><span class="meta">    after = &#123;HealthEndpointAutoConfiguration.class, InfoEndpointAutoConfiguration.class, WebEndpointAutoConfiguration.class, OAuth2ClientAutoConfiguration.class, OAuth2ResourceServerAutoConfiguration.class, Saml2RelyingPartyAutoConfiguration.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnDefaultWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagementWebSecurityAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ManagementWebSecurityAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Order(2147483642)</span></span><br><span class="line">    SecurityFilterChain <span class="title function_">managementSecurityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.authorizeHttpRequests((requests) -&gt; &#123;</span><br><span class="line">            ((AuthorizedUrl)requests.requestMatchers(<span class="keyword">new</span> <span class="title class_">RequestMatcher</span>[]&#123;EndpointRequest.to(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;HealthEndpoint.class&#125;)&#125;)).permitAll();</span><br><span class="line">            ((AuthorizedUrl)requests.anyRequest()).authenticated();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (ClassUtils.isPresent(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet&quot;</span>, (ClassLoader)<span class="literal">null</span>)) &#123;</span><br><span class="line">            http.cors(Customizer.withDefaults());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        http.formLogin(Customizer.withDefaults());</span><br><span class="line">        http.httpBasic(Customizer.withDefaults());</span><br><span class="line">        <span class="keyword">return</span> (SecurityFilterChain)http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>导入SpringSecurity启动器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>应用重启后，再访问应用的&#x2F;actuator&#x2F;health端点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/Jsl2ABZdUiPpDnm.png" alt="image-20231214104109954"></p>
<p>如果没有登录授权，则SpringBoot默认会跳到登录页面，需要输入默认的用户信息才能继续访问端点。</p>
<p>如果不想使用SpringBoot自动配置的默认机制，可以注册一个SecurityFilterChain实现自定义安全机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> http.authorizeHttpRequests((authorize) -&gt; &#123;</span><br><span class="line">                    authorize.requestMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">                            .requestMatchers(EndpointRequest.to(<span class="string">&quot;health&quot;</span>)).hasRole(<span class="string">&quot;ENDPOINT_ADMIN&quot;</span>)</span><br><span class="line">                            .requestMatchers(EndpointRequest.toAnyEndpoint()).permitAll();</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">//                .csrf(csrf -&gt; csrf.disable())</span></span><br><span class="line">                .csrf(csrf -&gt; csrf.ignoringRequestMatchers(EndpointRequest.toAnyEndpoint()))</span><br><span class="line">                .formLogin(withDefaults())</span><br><span class="line">                .logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .and().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">protected</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">InMemoryUserDetailsManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>();</span><br><span class="line">        manager.createUser(User.withUsername(<span class="string">&quot;test&quot;</span>).password(<span class="string">&quot;&#123;noop&#125;test&quot;</span>)</span><br><span class="line">                .roles(<span class="string">&quot;ENDPOINT_ADMIN&quot;</span>, <span class="string">&quot;ADMIN&quot;</span>, <span class="string">&quot;TEST&quot;</span>).build());</span><br><span class="line">        manager.createUser(User.withUsername(<span class="string">&quot;root&quot;</span>).password(<span class="string">&quot;&#123;noop&#125;root&quot;</span>)</span><br><span class="line">                .roles(<span class="string">&quot;ADMIN&quot;</span>).build());</span><br><span class="line">        <span class="keyword">return</span> manager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>端点授权配置需要用到EndpointRequest类，这里配置了只有health需要ENDPOINT_ADMIN角色才可以访问，其他接口的URL和端点不需要授权都能正常访问</p>
<p>然后创建了两个授权用户，{noop}表示明文密码，只有test用户才拥有ENDPOINT_ADMIN角色，输入其他用户就会返回403错误。</p>
<h3 id="自定义端点映射"><a href="#自定义端点映射" class="headerlink" title="自定义端点映射"></a>自定义端点映射</h3><p>默认情况下通过&#x2F;actuator跟路径可以显示所有暴露出来的端点。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/RJlxugZSNC9WX7k.png" alt="image-20231214105420296"></p>
<p>这样不是很安全，可以通过以下配置禁用：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>还可以更改默认的端点映射，因为默认的端点的URL前缀和端点ID所有人都知道，不是很安全，可以通过配置更改端点默认的前缀URL和端点ID：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/act</span></span><br><span class="line">      <span class="attr">path-mapping:</span> </span><br><span class="line">        <span class="attr">health:</span> <span class="string">hth</span></span><br></pre></td></tr></table></figure>

<p>这里把默认的端点前缀映射从&#x2F;actuator改为&#x2F;act，把health健康端点更名为hth</p>
<p>另外端点映射的IP地址和端口也可以更改，默认和Web应用共享一个Server，可以把端点Server独立出来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8088</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>adress和port是配套使用的，adress不是必需品。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/TjzutBcfXF8M5lg.png" alt="image-20231214110743327"></p>
<p>这里就可以看到日志启动了两个Server这样应用的端口和端点管理端口分开了。既然分开了，那么管理端点的Server要开启HTTPS访问就需要通过自己的management.server.sll.*系列参数控制。</p>
<p>另外把Server端点改为<code>-1</code>还能禁止以HTTP的方式暴露所有端点，和以exclude方式排除暴露端点是一样的。</p>
<p>所以通过关闭显示所有端点的页面和更改默认的端点映射与端口，也能起到保护端点安全的目的。</p>
<h3 id="端点实现机制"><a href="#端点实现机制" class="headerlink" title="端点实现机制"></a>端点实现机制</h3><p>内置端点一旦启用，SpringBoot就会自动配置，比如health端点的自动配置类为HealthEndpointAutoConfiguration，源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnAvailableEndpoint(</span></span><br><span class="line"><span class="meta">    endpoint = HealthEndpoint.class</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;HealthEndpointProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;HealthEndpointConfiguration.class, ReactiveHealthEndpointConfiguration.class, HealthEndpointWebExtensionConfiguration.class, HealthEndpointReactiveWebExtensionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthEndpointAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HealthEndpointAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动配置类是空的，其实是通过@Import注解导入了不同Web类型的端点配置类。</p>
<p>根据*.EndpointAutoConfiguration这个自动配置命名规则，可以很容易找到其他端点的自动配置类以及端点类，端点自动配置类都被注册到了新的配置文件中。</p>
<p>端点具体的实现类命名规则为*Endpoint，比如健康端点的实现类HealthEndpoint，部分源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Endpoint(</span></span><br><span class="line"><span class="meta">    id = &quot;health&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthEndpoint</span> <span class="keyword">extends</span> <span class="title class_">HealthEndpointSupport</span>&lt;HealthContributor, HealthComponent&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EndpointId</span> <span class="variable">ID</span> <span class="operator">=</span> EndpointId.of(<span class="string">&quot;health&quot;</span>);</span><br><span class="line">...</span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> HealthComponent <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HealthComponent</span> <span class="variable">health</span> <span class="operator">=</span> <span class="built_in">this</span>.health(ApiVersion.V3, EMPTY_PATH);</span><br><span class="line">        <span class="keyword">return</span> (HealthComponent)(health != <span class="literal">null</span> ? health : DEFAULT_HEALTH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> HealthComponent <span class="title function_">healthForPath</span><span class="params">(<span class="meta">@Selector(match = Match.ALL_REMAINING)</span> String... path)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.health(ApiVersion.V3, path);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>端点实现类通过一个@Endpoint注解修饰，并且需要注册为Spring中的Bean，在Web应用中支持JMX和Web两种暴露方式，也支持@JmxEndpoint和@WebEndpoint注解以不同的方式暴露，还可以通过@EndpointJmxExtension和@EndpointWebExtension注解扩展现有的端点。</p>
<p>通过在方法上定义不同的操作注解以实现不同HTTP方法与应用交互，支持的操作注解如下表：</p>
<table>
<thead>
<tr>
<th>操作注解</th>
<th>HTTP方法</th>
</tr>
</thead>
<tbody><tr>
<td>@ReadOperation</td>
<td>GET</td>
</tr>
<tr>
<td>@WriteOperation</td>
<td>POST</td>
</tr>
<tr>
<td>@DeleteOperation</td>
<td>DELETE</td>
</tr>
</tbody></table>
<p>如果Health端点中定义了两个@ReadOperation注解，说明这个端点只支持HTTP GET方法的请求，一个不带参数，另一个通过@Selector注解绑定Path路径上的参数</p>
<h3 id="自定义端点"><a href="#自定义端点" class="headerlink" title="自定义端点"></a>自定义端点</h3><p>了解的端点的视线机制，下面实现自定义的端点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebEndpoint(id=&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@Selector</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(id,<span class="string">&quot;xiaodong&quot;</span>,<span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WriteOperation</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">updateUser</span><span class="params">(<span class="type">int</span> id, <span class="meta">@Nullable</span> String name,<span class="meta">@Nullable</span> Integer age)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getUser(id);</span><br><span class="line">        user.setName(name);</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里创建了一个TestEndpoint端点类并通过@Component注册到Spring中，@WebEndpoint(id&#x3D;”test”)暴露了以HTTP方式访问，端点类提供了两个方法，用户获取用户信息和更新用户信息，端点ID为test。</p>
<p>由于@WebEndpoint等端点注解的enableByDefault参数默认是true，所以新建的端点默认是启用状态，不需要额外配置。虽然@WebEndpoint注解允许暴露为HTTP方式，但并未真正开启暴露，前面我们把Web方式暴露为<code>*</code>了，这里就不配置了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/k3McFYxwt1V9A2Z.png" alt="image-20231214114612932"></p>
<p>&#x2F;actuator&#x2F;test&#x2F;1后面的1是通过@Selector注解绑定到URL路径上的参数，默认只绑定单个参数，如果要绑定多个，则可以指定@Selector(match&#x3D;Match.ALL_REMAINNG)匹配路径上的所有参数。</p>
<p>如果发起一个POST请求，那么直接返回403错误，这是因为SpringBoot默认会开启CSRF（跨站请求伪造）保护机制，如果不是基于浏览器的应用，则建议关闭CSRF保护机制，关闭案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> http.authorizeHttpRequests((authorize) -&gt; &#123;</span><br><span class="line">                authorize.requestMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">                        .requestMatchers(EndpointRequest.to(<span class="string">&quot;health&quot;</span>)).hasRole(<span class="string">&quot;ENDPOINT_ADMIN&quot;</span>)</span><br><span class="line">                        .requestMatchers(EndpointRequest.toAnyEndpoint()).permitAll();</span><br><span class="line">            &#125;)</span><br><span class="line">            .csrf(csrf -&gt; csrf.disable())</span><br><span class="line">            <span class="comment">//.csrf(csrf -&gt; csrf.ignoringRequestMatchers(EndpointRequest.toAnyEndpoint()))</span></span><br><span class="line">            .formLogin(withDefaults())</span><br><span class="line">            .logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">            .and().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者只对端点映射关闭CSRF保护机制：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> http.authorizeHttpRequests((authorize) -&gt; &#123;</span><br><span class="line">                authorize.requestMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">                        .requestMatchers(EndpointRequest.to(<span class="string">&quot;health&quot;</span>)).hasRole(<span class="string">&quot;ENDPOINT_ADMIN&quot;</span>)</span><br><span class="line">                        .requestMatchers(EndpointRequest.toAnyEndpoint()).permitAll();</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//.csrf(csrf -&gt; csrf.disable())</span></span><br><span class="line">            .csrf(csrf -&gt; csrf.ignoringRequestMatchers(EndpointRequest.toAnyEndpoint()))</span><br><span class="line">            .formLogin(withDefaults())</span><br><span class="line">            .logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">            .and().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关闭后再重启应用再用POST方法调用即可。</p>
<p>如果端点类操作方法定义了参数，则参数不能为空，否则返回400错误，通过在方法参数上加@NullAble注解就可以允许参数为空。</p>
<p>另外，端点也支持跨域调用。如以下跨域配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">cors:</span></span><br><span class="line">        <span class="attr">allowed-origins:</span> <span class="string">&quot;https:xxxx.com&quot;</span></span><br><span class="line">        <span class="attr">allowed-methods:</span> <span class="string">&quot;POST,GET&quot;</span></span><br></pre></td></tr></table></figure>

<p>这样就可以语序来自https:xxxx.com网站的POST,GET方法请求了，这两个也支持通配符*</p>
<h2 id="loggers（日志端点）"><a href="#loggers（日志端点）" class="headerlink" title="loggers（日志端点）"></a>loggers（日志端点）</h2><p>SpringBoot提供了一个loggers日志端点，对应的端点类LoggersEndpoint，核心源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Endpoint(</span></span><br><span class="line"><span class="meta">    id = &quot;loggers&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@RegisterReflectionForBinding(&#123;LoggersEndpoint.GroupLoggerLevelsDescriptor.class, LoggersEndpoint.SingleLoggerLevelsDescriptor.class&#125;)</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> LoggersEndpoint.LoggersDescriptor <span class="title function_">loggers</span><span class="params">()</span> &#123;</span><br><span class="line">        Collection&lt;LoggerConfiguration&gt; configurations = <span class="built_in">this</span>.loggingSystem.getLoggerConfigurations();</span><br><span class="line">        <span class="keyword">return</span> configurations == <span class="literal">null</span> ? LoggersEndpoint.LoggersDescriptor.NONE : <span class="keyword">new</span> <span class="title class_">LoggersEndpoint</span>.LoggersDescriptor(<span class="built_in">this</span>.getLevels(), <span class="built_in">this</span>.getLoggers(configurations), <span class="built_in">this</span>.getGroups());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> LoggersEndpoint.LoggerLevelsDescriptor <span class="title function_">loggerLevels</span><span class="params">(<span class="meta">@Selector</span> String name)</span> &#123;</span><br><span class="line">        Assert.notNull(name, <span class="string">&quot;Name must not be null&quot;</span>);</span><br><span class="line">        <span class="type">LoggerGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="built_in">this</span>.loggerGroups.get(name);</span><br><span class="line">        <span class="keyword">if</span> (group != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoggersEndpoint</span>.GroupLoggerLevelsDescriptor(group.getConfiguredLevel(), group.getMembers());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">LoggerConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="built_in">this</span>.loggingSystem.getLoggerConfiguration(name);</span><br><span class="line">            <span class="keyword">return</span> configuration != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">LoggersEndpoint</span>.SingleLoggerLevelsDescriptor(configuration) : <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WriteOperation</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureLogLevel</span><span class="params">(<span class="meta">@Selector</span> String name, <span class="meta">@Nullable</span> LogLevel configuredLevel)</span> &#123;</span><br><span class="line">        Assert.notNull(name, <span class="string">&quot;Name must not be empty&quot;</span>);</span><br><span class="line">        <span class="type">LoggerGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="built_in">this</span>.loggerGroups.get(name);</span><br><span class="line">        <span class="keyword">if</span> (group != <span class="literal">null</span> &amp;&amp; group.hasMembers()) &#123;</span><br><span class="line">            <span class="type">LoggingSystem</span> <span class="variable">var10002</span> <span class="operator">=</span> <span class="built_in">this</span>.loggingSystem;</span><br><span class="line">            Objects.requireNonNull(var10002);</span><br><span class="line">            group.configureLogLevel(configuredLevel, var10002::setLogLevel);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.loggingSystem.setLogLevel(name, configuredLevel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>日志端点提供了两个读和一个写操作，可以查看正在运行的应用的日志级别设置，也可以动态调整某个包的日志级别，该端点默认不会暴露，需要自行暴露。</p>
<p>获取日志端点信息(GET):</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/NWym3ugQI2br6JH.png" alt="image-20231214142750095"></p>
<p>loggers日志端点支持设置的日志级别有 “OFF”,”ERROR”,”WARN”, “INFO”, “DEBUG”, “TRACE”,”null”（恢复默认设置）</p>
<p>loggers日志端点目前只能用来查看和更新包的日志级别，以及查看所有的日志分组，但不支持查看和更新复杂的日志配置。</p>
<h2 id="Observability（可观测性，Spring-Boot-3-0-）"><a href="#Observability（可观测性，Spring-Boot-3-0-）" class="headerlink" title="Observability（可观测性，Spring Boot 3.0+）"></a>Observability（可观测性，Spring Boot 3.0+）</h2><p>Observability（可观测性）是指从系统外部观测正在运行的系统内部的状态的能力。</p>
<p>Observability主要是由以下三大组件组成：</p>
<ul>
<li>Logging（日志记录）</li>
<li>Metrics（度量&#x2F;指标）</li>
<li>Traces（链路跟踪）</li>
</ul>
<p>日志就是指平常的日志输出，对于指标和跟踪，SpringBoot使用的是MicrometerObservability，如果要创建自己的Observation，则可以注入一个ObservationRegistry，并使用它添加对应的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexObservation</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObservationRegistry observationRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">observe</span><span class="params">()</span>&#123;</span><br><span class="line">        Observation.createNotStarted(<span class="string">&quot;indexObservation&quot;</span>,<span class="built_in">this</span>.observationRegistry)</span><br><span class="line">                .lowCardinalityKeyValue(<span class="string">&quot;area&quot;</span>,<span class="string">&quot;com&quot;</span>)</span><br><span class="line">                .highCardinalityKeyValue(<span class="string">&quot;userId&quot;</span>,<span class="string">&quot;10099&quot;</span>)</span><br><span class="line">                .observe(() -&gt;&#123;</span><br><span class="line">                    <span class="comment">//执行观测时的业务逻辑</span></span><br><span class="line">                    log.info(<span class="string">&quot;开始执行业务逻辑&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心：</p>
<ul>
<li>createNotStarted：创建一个Observation，但不会马上启动观测</li>
<li>lowCardinalityKeyValue：指定低基数的标签，它们将被添加到Metrics和Traces中</li>
<li>highCardinalityKeyValue：指定高基数的标签，它将被添加到Traces中</li>
<li>observe：开始执行当前Observation观测，并传入一个Runnable线程用于执行业务逻辑。</li>
</ul>
<p>observe方法接收一个Runnable线程参数，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">observe</span><span class="params">(Runnable runnable)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Observation.<span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> <span class="built_in">this</span>.openScope();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runnable.run();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var11) &#123;</span><br><span class="line">            <span class="keyword">if</span> (scope != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    scope.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable var10) &#123;</span><br><span class="line">                    var11.addSuppressed(var10);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> var11;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (scope != <span class="literal">null</span>) &#123;</span><br><span class="line">            scope.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var12) &#123;</span><br><span class="line">        <span class="built_in">this</span>.error(var12);</span><br><span class="line">        <span class="keyword">throw</span> var12;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>他主要由以下几个过程组成：</p>
<ul>
<li>打开Observation</li>
<li>打开一个scope</li>
<li>调用线程Runnable.run()方法</li>
<li>关闭scope</li>
<li>如果有错误，则向观测对象发出错误信号</li>
<li>停止Observation</li>
</ul>
<p>现在改造一下&#x2F;首页接口，让首页执行IndexObservation观测：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IndexObservation indexObservation;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;this is index page&quot;</span>);</span><br><span class="line">        indexObservation.observe();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index page&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注入IndexObservation并调用其indexObservation方法开始执行Observation观测，然后会记录首页观测到的相关标签数据，可以在链路跟踪中查找并且展示，具体效果见后续的Traces链路跟踪。</p>
<h2 id="Metrics（指标）"><a href="#Metrics（指标）" class="headerlink" title="Metrics（指标）"></a>Metrics（指标）</h2><h3 id="内置指标"><a href="#内置指标" class="headerlink" title="内置指标"></a>内置指标</h3><p>SpringBoot内置了各种技术的指标的实现，比如JVM、System、Tomcat、Logger、SpringMVC等，通过&#x2F;actuator&#x2F;metrics指标端点可以显示所有应用收集到的指标：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/AGmYHI5wUCVyWFr.png" alt="image-20231214150341862"></p>
<p>此端点默认是不暴露的，需要自行暴露，另外可以通过&#x2F;actuator&#x2F;metrics&#x2F;xxx查看详细指标信息，比如通过&#x2F;actuator&#x2F;metrics&#x2F;jvm.memory.max路径查看JVM最大内存：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/uvpzaB57FGjTPe9.png" alt="image-20231214150535730"></p>
<h3 id="自定义指标"><a href="#自定义指标" class="headerlink" title="自定义指标"></a>自定义指标</h3><p>如果SpringBoot提供的指标不符合要求，则可以通过注册多个MeterBinder实现多个自定义指标，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MeterBinder <span class="title function_">initDate</span><span class="params">(Environment env)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (registry) -&gt; Gauge.builder(<span class="string">&quot;init.date&quot;</span>, <span class="built_in">this</span>::date).register(registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MeterBinder <span class="title function_">systemDate</span><span class="params">(Environment env)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (registry) -&gt; Gauge.builder(<span class="string">&quot;system.date&quot;</span>, <span class="built_in">this</span>::date).register(registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Number <span class="title function_">date</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2023.12</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里创建了两个指标，通过&#x2F;actuator&#x2F;metrics&#x2F;或者&#x2F;actuator&#x2F;prometheus端点可以验证指标是否被收集：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/qDf6pLz3SVI2UNi.png" alt="image-20231214151544871"></p>
<p>然后获取该指标的信息：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/hpNoYtE6DyZzB5a.png" alt="image-20231214151616330"></p>
<h2 id="Traces（链路跟踪，SpringBoot3-0-）"><a href="#Traces（链路跟踪，SpringBoot3-0-）" class="headerlink" title="Traces（链路跟踪，SpringBoot3.0+）"></a>Traces（链路跟踪，SpringBoot3.0+）</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>Spring Boot  Actuator为Micrometer Tracing提供了依赖管理和自动配置，Micrometer 是当前比较流行的跟踪类库门面，SpringBoot为以下Tracers链路跟踪解决方案提供了自动配置：</p>
<ul>
<li>使用OpenTelemetry结合Zipkin或者WaveFront</li>
<li>使用OpenZipkin Brave结合Zipkin或者WaveFront</li>
</ul>
<p>OpenTelemetry是 CNCF 的一个可观测性项目，旨在提供可观测性领域的标准化方案，解决观测数据的数据模型、采集、处理、导出等的标准化问题，提供与三方 vendor 无关的服务。</p>
<p>OpenZipkin是基于 Java 的分布式追踪系统，用于收集和查找来自分布式系统的数据。</p>
<h3 id="链路跟踪环境搭建（zipkin）"><a href="#链路跟踪环境搭建（zipkin）" class="headerlink" title="链路跟踪环境搭建（zipkin）"></a>链路跟踪环境搭建（zipkin）</h3><p>这里以Windows为例子：</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/io/zipkin/zipkin-server/">https://repo1.maven.org/maven2/io/zipkin/zipkin-server/</a></p>
<p>然后把下载好的jar包放到自己的目录下，进入IDE编辑器终端：</p>
<p>执行<code>java -jar 下载好的jar包</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/FCcmeNo2Bbr4SVv.png" alt="image-20231214154803014"></p>
<p>安装并运行Zipkin后访问<a target="_blank" rel="noopener" href="http://127.0.0.1:9411/">http://127.0.0.1:9411/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/EnubUcvtDTWAZ2y.png" alt="image-20231214154907780"></p>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--将micrometer Observation API桥接到OpenTelemetry--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-tracing-bridge-otel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--向ZipKin报告调用链路跟踪信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-exporter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加采样参数：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">tracing:</span></span><br><span class="line">    <span class="attr">sampling:</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1.0</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，SpringBoot仅对10%的请求进行采样（0.1），以防止Traces跟踪导致后端系统不堪重负，这里为了便于测试，将采样参数设置为1.0即100%，对所有请求都采样</p>
<p>如果需要在日志中展示TraceID和SpanID，可以这样设置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">$&#123;spring.application.name:&#125;,%X&#123;traceId:-&#125;,%X&#123;spanId:-&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>traceId：链路跟踪ID，一次请求完整链路的唯一标识，由一组Span单元组成的一个树状结构。</li>
<li>spanId：基本工作单元ID，每条链路都有不同的SpanID组成。</li>
</ul>
<h3 id="链路跟踪-x2F-展示"><a href="#链路跟踪-x2F-展示" class="headerlink" title="链路跟踪&#x2F;展示"></a>链路跟踪&#x2F;展示</h3><p>链路跟踪环境搭建好及Zipkin启动之后，再启动应用，并发起HTTP接口调用，SpringBoot会为HTTP请求创建一个Observation观测，它桥接到OpenTelemetry，然后通过OpenTelemetry向Zipkin报告每个链路的跟踪数据。</p>
<p>再Observability可观性中，已经为首页实现了自定义的IndexObservation观测并记录了相关标签数据，现在调用<a target="_blank" rel="noopener" href="http://localhost/%E6%8E%A5%E5%8F%A3%E3%80%82">http://localhost/接口。</a></p>
<p>Zipkin：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/fo3BIQmJnzuTKwe.png" alt="image-20231214160725135"></p>
<p>可以看到三此请求的链路，随便点击一条进入详细链路：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/qMHtxI71dLKOfYk.png" alt="image-20231214160851168"></p>
<p>可以看到首页观测记录及携带的area和userId标签数据，后台也记录了调用链路跟踪日志：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/RCENyZ4GWglm3L7.png" alt="image-20231214160954685"></p>
<p>可以看到一条链路输出了两条日志，也就是在&#x2F;首页方法中输出的两条日志，其中TraceID相同，SpanID不同</p>
<h2 id="Spring-Boot-Admin"><a href="#Spring-Boot-Admin" class="headerlink" title="Spring Boot Admin"></a>Spring Boot Admin</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>Spring Boot Admin&#x3D;Spring Boot+Admin，用于管理和监控SpringBoot应用，它并不是Spring Boot官方提供的，而是某个社区开源的。</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring-boot-admin.com/current/">Spring Boot Admin – (spring-boot-admin.com)</a></p>
<p>开源官网显示SpringBootAdmin的主要功能如下：</p>
<ul>
<li>显示应用程序的监控状态</li>
<li>应用程序上下线监控</li>
<li>查看 JVM，线程信息</li>
<li>可视化的查看日志以及下载日志文件</li>
<li>动态切换日志级别</li>
<li>Http 请求信息跟踪</li>
<li>其他功能点……</li>
</ul>
<p>Spring Boot Admin 包括Spring Boot Admin Server和Spring Boot Admin Client，Spring Boot Admin Client即SpringBoot应用，以HTTP的方式向Spring Boot Admin Server注册，Spring Cloud应用则通过Eureka，Consul等注册中心进行注册，Spring Boot Admin UI只是基于Spring Boot Acturator端点之上的Vue.js应用。</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>SpringBoot集成Spring Boot Admin需要先搭建Spring Boot Admin Server，再搭建Spring Boot Admin Client，Spring Boot Admin Server用于收集Spring Boot Admin Client的健康数据并进行监控报警。</p>
<h4 id="1-搭建Spring-Boot-Admin-Server"><a href="#1-搭建Spring-Boot-Admin-Server" class="headerlink" title="1.	搭建Spring Boot Admin Server"></a>1.	搭建Spring Boot Admin Server</h4><p>导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot-admin-starter-server.version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">spring-boot-admin-starter-server.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot-admin-starter-server.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--还需要Web模块，这里在总的pom中就不引入了--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>在启动类上添@EnableAdminServer注解以启用Spring Boot Admin Server：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootAdminServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootAdminServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>application.yaml:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8088</span></span><br></pre></td></tr></table></figure>





<h4 id="2-搭建Spring-Boot-Admin-Client"><a href="#2-搭建Spring-Boot-Admin-Client" class="headerlink" title="2.	搭建Spring Boot Admin Client"></a>2.	搭建Spring Boot Admin Client</h4><p>导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot-admin-starter-client.version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">spring-boot-admin-starter-client.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot-admin-starter-client.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>然后添加以下配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://localhost:8088</span> <span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment">#2</span></span><br><span class="line">  <span class="attr">info:</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>  <span class="comment">#3</span></span><br></pre></td></tr></table></figure>

<p>核心参数说明如下：</p>
<ul>
<li>#1：指定需要注册的SpringBootAdminServer地址</li>
<li>#2：SpringBoot3.0开始默认只暴露Health健康端点，这里全部暴露了，在生产环境中需谨慎选择</li>
<li>#3：env的信息默认是禁用的，这里开启</li>
</ul>
<p>然后禁用所有安全机制，让Actuator所有端点都可以被访问，配置如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityPermitAllConfig</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> http.authorizeHttpRequests((authorize) -&gt; &#123;</span><br><span class="line">            authorize.anyRequest().permitAll();</span><br><span class="line">        &#125;).csrf().disable().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里为了测试，先禁用了所有安全措施，确保所有端点都可以被访问，不然无法被监控到，实际项目中可自行设置安全性。</p>
<p>application.yaml:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://localhost:8088</span> <span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment">#2</span></span><br><span class="line">  <span class="attr">info:</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>  <span class="comment">#3</span></span><br></pre></td></tr></table></figure>



<p>项目配置完毕后，先启动服务端Server，在启动客户端Client即可。</p>
<h4 id="3-监控页面"><a href="#3-监控页面" class="headerlink" title="3.	监控页面"></a>3.	监控页面</h4><p>打开Spring Boot Admin Server控制台：<a target="_blank" rel="noopener" href="http://localhost:8088/">http://localhost:8088/</a></p>
<h5 id="首页菜单"><a href="#首页菜单" class="headerlink" title="首页菜单"></a>首页菜单</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/hNASy27HjYm8Q5o.png" alt="image-20231214174219488"></p>
<p>服务端和客户端都运行成功了，单击对应的项目，可以看到更多的细节。</p>
<h5 id="细节菜单"><a href="#细节菜单" class="headerlink" title="细节菜单"></a>细节菜单</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/FqO5jiV6Wm1wtSQ.png" alt="image-20231214174534772"></p>
<p>细节菜单中展示了一些健康、JVM相关信息，这些信息有助于开发者掌握应用的JVM健康状况。</p>
<h5 id="性能菜单"><a href="#性能菜单" class="headerlink" title="性能菜单"></a>性能菜单</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/umay5tfxPAJYobM.png" alt="image-20231214175310671"></p>
<h5 id="环境菜单"><a href="#环境菜单" class="headerlink" title="环境菜单"></a>环境菜单</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/68V5FHeMOlh14zx.png" alt="image-20231214175356934"></p>
<h5 id="类菜单"><a href="#类菜单" class="headerlink" title="类菜单"></a>类菜单</h5><p>类菜单中有所有Spring容器中的Bean，以及是否是单例</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/HARgKNdZo8fcG25.png" alt="image-20231214175429917"></p>
<h5 id="配置属性菜单"><a href="#配置属性菜单" class="headerlink" title="配置属性菜单"></a>配置属性菜单</h5><p>配置属性菜单显示所有SpringBoot的配置参数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/SlWcnOf45mUQF2e.png" alt="image-20231214175454841"></p>
<h5 id="计划任务菜单"><a href="#计划任务菜单" class="headerlink" title="计划任务菜单"></a>计划任务菜单</h5><p>现在去写一个计划任务重新启动一下客户端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootAdminClientApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootAdminClientApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/10 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是一个每十秒执行的任务，用来查看计划任务菜单&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/byECV9ItFr6Yq4w.png" alt="image-20231214175852566"></p>
<p>这里只能展示任务信息及状态，不可以进行控制。</p>
<h5 id="日志配置菜单"><a href="#日志配置菜单" class="headerlink" title="日志配置菜单"></a>日志配置菜单</h5><p>日志配置菜单中显示所有类的日志级别，并能修改某个类的日志级别</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/q5h4DvfHAriQpZV.png" alt="image-20231214175924901"></p>
<p>默认情况下，日志文件无法通过日志端点访问，需要在客户端应用配置logging.file，path或者logging.file.name参数来启用logfile端点。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">./logs/admin-client.log</span></span><br></pre></td></tr></table></figure>



<p>再重启应用就可以看到日志文件的内容了。</p>
<h5 id="JVM菜单"><a href="#JVM菜单" class="headerlink" title="JVM菜单"></a>JVM菜单</h5><p>JVM菜单可以显示当前所有线程堆栈、堆栈，并能进行下载分析。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/d7VZT3UJPROXy6W.png" alt="image-20231214180359274"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/SwymbatVzHghDYc.png" alt="image-20231214180512601"></p>
<h5 id="映射菜单"><a href="#映射菜单" class="headerlink" title="映射菜单"></a>映射菜单</h5><p>可以显示所有URL映射</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/KU91GktguHJwzCc.png" alt="image-20231214180602294"></p>
<h5 id="缓存菜单"><a href="#缓存菜单" class="headerlink" title="缓存菜单"></a>缓存菜单</h5><p>显示所有缓存</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/aszD7XOof6KPQGE.png" alt="image-20231214180636638"></p>
<p>这里不仅可以展示，还可以清除和管理缓存。</p>
<p>SpringBootAdmin用于管理和监控SpringBoot应用，具体就是通过客户端暴露的各种&#x2F;actuatar端点和指标实现的，并在此基础上进行了一些包装和UI展示</p>
<h4 id="4-监控报警"><a href="#4-监控报警" class="headerlink" title="4.	监控报警"></a>4.	监控报警</h4><h5 id="浏览器通知"><a href="#浏览器通知" class="headerlink" title="浏览器通知"></a>浏览器通知</h5><p>现在把客户端停掉，若干秒后页面会自动刷新</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/14/Krvj6xMXROl5fde.png" alt="image-20231214181237748"></p>
<p>离线实例显示1，应用出现在离线实例中了，如果浏览器没有禁用通知，那么同时会发出应用上线&#x2F;下线的通知（我这里是禁用了的）</p>
<p>在AdminServerAutoConfiguration自动配置类中注册了一个状态变更触发器，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(</span></span><br><span class="line"><span class="meta">    initMethod = &quot;start&quot;,</span></span><br><span class="line"><span class="meta">    destroyMethod = &quot;stop&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="keyword">public</span> StatusUpdateTrigger <span class="title function_">statusUpdateTrigger</span><span class="params">(StatusUpdater statusUpdater, Publisher&lt;InstanceEvent&gt; events)</span> &#123;</span><br><span class="line">    <span class="type">StatusUpdateTrigger</span> <span class="variable">trigger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatusUpdateTrigger</span>(statusUpdater, events);</span><br><span class="line">    trigger.setInterval(<span class="built_in">this</span>.adminServerProperties.getMonitor().getStatusInterval());</span><br><span class="line">    trigger.setLifetime(<span class="built_in">this</span>.adminServerProperties.getMonitor().getStatusLifetime());</span><br><span class="line">    <span class="keyword">return</span> trigger;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认每10秒会检测一下实例的状态，如果需要修改检测时间间隔，那么可以参考AdminServerProperties和MonitorProperties参数配置类进行配置。</p>
<h5 id="邮件通知"><a href="#邮件通知" class="headerlink" title="邮件通知"></a>邮件通知</h5><p>在Spring Boot Admin Server项目中导入spring boot starter -mail邮件启动器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置JavaMainSender及收件人信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">135xxx@qq.com</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="string">&quot;[mail.smtp.socketFactory.class]&quot;</span><span class="string">:</span> <span class="string">javax.net.ssl.SSLSocketFactory</span></span><br><span class="line">      <span class="string">&quot;[mail.smtp.socketFactory.fallback]&quot;</span><span class="string">:</span> <span class="literal">false</span></span><br><span class="line">      <span class="string">&quot;[mail.smtp.socketFactory.port]&quot;</span><span class="string">:</span> <span class="number">465</span></span><br><span class="line">      <span class="string">&quot;[mail.smtp.connectiontimeout]&quot;</span><span class="string">:</span> <span class="number">5000</span></span><br><span class="line">      <span class="string">&quot;[mail.smtp.timeout]&quot;</span><span class="string">:</span> <span class="number">3000</span></span><br><span class="line">      <span class="string">&quot;[mail.smtp.writetimeout]&quot;</span><span class="string">:</span> <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">notify:</span></span><br><span class="line">        <span class="attr">mail:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">from:</span> <span class="string">Spring</span> <span class="string">Boot</span> <span class="string">Admin</span> <span class="string">&lt;13xxx@qq.com&gt;</span> <span class="comment">#发件人</span></span><br><span class="line">          <span class="attr">to:</span> <span class="string">31xxx@qq.com</span> <span class="comment">#收件人</span></span><br><span class="line">          <span class="attr">cc:</span> <span class="string">13xxx@qq.com</span> <span class="comment">#抄送人</span></span><br></pre></td></tr></table></figure>

<p>简单配置好了发件人、收件人和抄送人后，即可尝试去启动Server和Client，Client退出后等待邮箱消息：</p>
<p>从服务端的控制台可以看到服务端无法连接到客户端应用的异常日志：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./image/image-20231215100640521.png" alt="image-20231215100640521"></p>
<p>邮件也会收到这样的内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/15/Zh6fyO3VoWTg5Fn.png" alt="image-20231215095932680"></p>
<p>从邮件的内容中可以看到应用实例下线的相关信息，为了防止敏感信息泄露，内置的默认邮件模版不会实例任何元数据信息，如果有需要，则可以自定义Thymeleaf模版。</p>
<p>更多的配置信息可以参考AdminServerNotifierAutoConfiguration#mailNotifier注册的MailNotifier实例，源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;spring.boot.admin.notify.mail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> MailNotifier <span class="title function_">mailNotifier</span><span class="params">(JavaMailSender mailSender, InstanceRepository repository, TemplateEngine mailNotifierTemplateEngine)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailNotifier</span>(mailSender, repository, mailNotifierTemplateEngine);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MailNotifier类源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailNotifier</span> <span class="keyword">extends</span> <span class="title class_">AbstractStatusChangeNotifier</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JavaMailSender mailSender;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TemplateEngine templateEngine;</span><br><span class="line">    <span class="keyword">private</span> String[] to = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;root@localhost&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> String[] cc = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">from</span> <span class="operator">=</span> <span class="string">&quot;Spring Boot Admin &lt;noreply@localhost&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; additionalProperties = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> String baseUrl;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> <span class="string">&quot;classpath:/META-INF/spring-boot-admin-server/mail/status-changed.html&quot;</span>;</span><br><span class="line"> ....   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源码中可所有的显示参数都是可以配置的，可以看到邮件通知默认使用的是SpringBootAdmin内置的Thymeleaf模版：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/12/15/4j2X3rbfBQcygsF.png" alt="image-20231215100514750"></p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>Spring Boot Admin 监控功能很简单，只能监控应用的状态，，而不能监控中间件的健康状况，所以不能替代专业的监控系统(比如：Prometheus+Grafana监控系统组合)，但至少Spring Boot Admin 足够轻量级，只需要启动一个服务端应用，而不需要太多复杂的组件，所以，对于那些简单的SpringBoot应用还是够用。</p>
<h2 id="Prometheus-Grafana"><a href="#Prometheus-Grafana" class="headerlink" title="Prometheus+Grafana"></a>Prometheus+Grafana</h2><p>暂时缺少Linux环境</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/06/tvBb7V3ND9Y6hIc.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/06/tvBb7V3ND9Y6hIc.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">小东</div><div class="post-copyright__author_desc">道阻且长 行则将至</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://humbledong.github.io/undefined/32643233.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://humbledong.github.io/undefined/32643233.html')">SpringBoot监控与报警</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://s2.loli.net/2024/01/06/6TXERj7mhpLnsGB.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/06/6TXERj7mhpLnsGB.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2024/01/06/2TQtWAnv8Of1ykp.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://humbledong.github.io/undefined/32643233.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SpringBoot监控与报警&amp;url=https://humbledong.github.io/undefined/32643233.html&amp;pic=https://s2.loli.net/2024/01/08/DBhgJApORaw1FXi.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://humbledong.github.io" target="_blank">七岁就很浪</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/SpringBoot3/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>SpringBoot3<span class="tagsPageCount">10</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2024/01/08/DBhgJApORaw1FXi.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/undefined/5d2d95e5.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/M3rRJKpo4wB1HOj.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringBoot打包与部署</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/undefined/91f6cd83.html" title="SpringBootStarter和自动配置"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/h2Rw57fbxdO469a.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-15</div><div class="title">SpringBootStarter和自动配置</div></div></a></div><div><a href="/undefined/46f3ef61.html" title="SpringBootWeb核心应用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/cVJFZz9IYWhXBPs.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-20</div><div class="title">SpringBootWeb核心应用</div></div></a></div><div><a href="/undefined/d6c1f1a5.html" title="SpringBoot任务"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/EJbQ2HtR4WNZqo5.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-22</div><div class="title">SpringBoot任务</div></div></a></div><div><a href="/undefined/16cf83b7.html" title="SpringBoot数据访问"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/lVt6fop81yIKim3.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-21</div><div class="title">SpringBoot数据访问</div></div></a></div><div><a href="/undefined/5d2d95e5.html" title="SpringBoot打包与部署"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/M3rRJKpo4wB1HOj.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-25</div><div class="title">SpringBoot打包与部署</div></div></a></div><div><a href="/undefined/c4b502db.html" title="SpringBoot启动过程与拓展应用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/oQKk97qz8sSX6rH.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-17</div><div class="title">SpringBoot启动过程与拓展应用</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/06/tvBb7V3ND9Y6hIc.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhheo/Sticker-Heo@latest/Sticker-100/出家人.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">Java</b>相关的问题和看法，还有<b style="color:#fff">喜欢的东西的看法和</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小东</h1><div class="author-info__desc">道阻且长 行则将至</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/humbleDong" target="_blank" title="Github"></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/608736096" target="_blank" title="BiliBili"></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%8A%A5%E8%AD%A6"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot监控与报警</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot-Actuator%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Spring Boot  Actuator概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Endpoints%EF%BC%88%E7%AB%AF%E7%82%B9%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">Endpoints（端点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%AB%AF%E7%82%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">内置端点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E7%AB%AF%E7%82%B9"><span class="toc-number">1.2.3.</span> <span class="toc-text">启用端点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E7%82%B9"><span class="toc-number">1.2.4.</span> <span class="toc-text">暴露端点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E7%82%B9%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">1.2.5.</span> <span class="toc-text">端点安全性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AB%AF%E7%82%B9%E6%98%A0%E5%B0%84"><span class="toc-number">1.2.6.</span> <span class="toc-text">自定义端点映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E7%82%B9%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="toc-number">1.2.7.</span> <span class="toc-text">端点实现机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AB%AF%E7%82%B9"><span class="toc-number">1.2.8.</span> <span class="toc-text">自定义端点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#loggers%EF%BC%88%E6%97%A5%E5%BF%97%E7%AB%AF%E7%82%B9%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">loggers（日志端点）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Observability%EF%BC%88%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%EF%BC%8CSpring-Boot-3-0-%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">Observability（可观测性，Spring Boot 3.0+）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Metrics%EF%BC%88%E6%8C%87%E6%A0%87%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">Metrics（指标）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E6%8C%87%E6%A0%87"><span class="toc-number">1.5.1.</span> <span class="toc-text">内置指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87"><span class="toc-number">1.5.2.</span> <span class="toc-text">自定义指标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Traces%EF%BC%88%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%EF%BC%8CSpringBoot3-0-%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">Traces（链路跟踪，SpringBoot3.0+）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">1.6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88zipkin%EF%BC%89"><span class="toc-number">1.6.2.</span> <span class="toc-text">链路跟踪环境搭建（zipkin）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA-x2F-%E5%B1%95%E7%A4%BA"><span class="toc-number">1.6.3.</span> <span class="toc-text">链路跟踪&#x2F;展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot-Admin"><span class="toc-number">1.7.</span> <span class="toc-text">Spring Boot Admin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">1.7.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.7.2.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%90%AD%E5%BB%BASpring-Boot-Admin-Server"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">1.	搭建Spring Boot Admin Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BASpring-Boot-Admin-Client"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">2.	搭建Spring Boot Admin Client</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">3.	监控页面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.1.</span> <span class="toc-text">首页菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%86%E8%8A%82%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.2.</span> <span class="toc-text">细节菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.3.</span> <span class="toc-text">性能菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.4.</span> <span class="toc-text">环境菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.5.</span> <span class="toc-text">类菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.6.</span> <span class="toc-text">配置属性菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.7.</span> <span class="toc-text">计划任务菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.8.</span> <span class="toc-text">日志配置菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JVM%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.9.</span> <span class="toc-text">JVM菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.10.</span> <span class="toc-text">映射菜单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%8F%9C%E5%8D%95"><span class="toc-number">1.7.2.3.11.</span> <span class="toc-text">缓存菜单</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%9B%91%E6%8E%A7%E6%8A%A5%E8%AD%A6"><span class="toc-number">1.7.2.4.</span> <span class="toc-text">4.	监控报警</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E9%80%9A%E7%9F%A5"><span class="toc-number">1.7.2.4.1.</span> <span class="toc-text">浏览器通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5"><span class="toc-number">1.7.2.4.2.</span> <span class="toc-text">邮件通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.2.4.3.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prometheus-Grafana"><span class="toc-number">1.8.</span> <span class="toc-text">Prometheus+Grafana</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/undefined/32643233.html" title="SpringBoot监控与报警"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/DBhgJApORaw1FXi.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot监控与报警"/></a><div class="content"><a class="title" href="/undefined/32643233.html" title="SpringBoot监控与报警">SpringBoot监控与报警</a><time datetime="2023-10-28T06:14:20.000Z" title="发表于 2023-10-28 14:14:20">2023-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/5d2d95e5.html" title="SpringBoot打包与部署"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/M3rRJKpo4wB1HOj.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot打包与部署"/></a><div class="content"><a class="title" href="/undefined/5d2d95e5.html" title="SpringBoot打包与部署">SpringBoot打包与部署</a><time datetime="2023-10-25T06:14:20.000Z" title="发表于 2023-10-25 14:14:20">2023-10-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/e2fd590a.html" title="SpringBoot调试与单元测试"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/yBoXGRVkvzJEHin.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot调试与单元测试"/></a><div class="content"><a class="title" href="/undefined/e2fd590a.html" title="SpringBoot调试与单元测试">SpringBoot调试与单元测试</a><time datetime="2023-10-24T06:14:20.000Z" title="发表于 2023-10-24 14:14:20">2023-10-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/d6c1f1a5.html" title="SpringBoot任务"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/EJbQ2HtR4WNZqo5.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot任务"/></a><div class="content"><a class="title" href="/undefined/d6c1f1a5.html" title="SpringBoot任务">SpringBoot任务</a><time datetime="2023-10-22T06:14:20.000Z" title="发表于 2023-10-22 14:14:20">2023-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/16cf83b7.html" title="SpringBoot数据访问"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/01/08/lVt6fop81yIKim3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot数据访问"/></a><div class="content"><a class="title" href="/undefined/16cf83b7.html" title="SpringBoot数据访问">SpringBoot数据访问</a><time datetime="2023-10-21T06:14:20.000Z" title="发表于 2023-10-21 14:14:20">2023-10-21</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/fish.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2024 By <a class="footer-bar-link" href="/" title="小东" target="_blank">小东</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">我的</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.cnblogs.com/qisui/" title="博客园"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/blog.ico" alt="博客园"/><span class="back-menu-item-text">博客园</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">常用</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.processon.com/" title="processon画图"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/processon.ico" alt="processon画图"/><span class="back-menu-item-text">processon画图</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AOF/" style="font-size: 0.88rem;">AOF<sup>1</sup></a><a href="/tags/AOP/" style="font-size: 0.88rem;">AOP<sup>1</sup></a><a href="/tags/Ajax/" style="font-size: 0.88rem;">Ajax<sup>1</sup></a><a href="/tags/Druid/" style="font-size: 0.88rem;">Druid<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>2</sup></a><a href="/tags/IoC/" style="font-size: 0.88rem;">IoC<sup>1</sup></a><a href="/tags/JSON/" style="font-size: 0.88rem;">JSON<sup>1</sup></a><a href="/tags/JSP/" style="font-size: 0.88rem;">JSP<sup>1</sup></a><a href="/tags/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">Java多线程<sup>1</sup></a><a href="/tags/Java%E8%BF%9B%E9%98%B6/" style="font-size: 0.88rem;">Java进阶<sup>2</sup></a><a href="/tags/Linux%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" style="font-size: 0.88rem;">Linux基本命令<sup>1</sup></a><a href="/tags/Linux%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Linux基础<sup>1</sup></a><a href="/tags/Maven/" style="font-size: 0.88rem;">Maven<sup>1</sup></a><a href="/tags/MyBatis-plus/" style="font-size: 0.88rem;">MyBatis-plus<sup>2</sup></a><a href="/tags/MySQL%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">MySQL基础<sup>1</sup></a><a href="/tags/Mybatis/" style="font-size: 0.88rem;">Mybatis<sup>1</sup></a><a href="/tags/RDB/" style="font-size: 0.88rem;">RDB<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>2</sup></a><a href="/tags/Servlet/" style="font-size: 0.88rem;">Servlet<sup>1</sup></a><a href="/tags/Shiro/" style="font-size: 0.88rem;">Shiro<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>1</sup></a><a href="/tags/SpringBoot-CRUD/" style="font-size: 0.88rem;">SpringBoot-CRUD<sup>1</sup></a><a href="/tags/SpringBoot3/" style="font-size: 0.88rem;">SpringBoot3<sup>10</sup></a><a href="/tags/SpringBoot%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">SpringBoot原理<sup>1</sup></a><a href="/tags/SpringMVC/" style="font-size: 0.88rem;">SpringMVC<sup>1</sup></a><a href="/tags/SpringSecurity/" style="font-size: 0.88rem;">SpringSecurity<sup>1</sup></a><a href="/tags/Spring%E4%BA%8B%E5%8A%A1/" style="font-size: 0.88rem;">Spring事务<sup>1</sup></a><a href="/tags/Swagger/" style="font-size: 0.88rem;">Swagger<sup>1</sup></a><a href="/tags/Thymeleaf/" style="font-size: 0.88rem;">Thymeleaf<sup>1</sup></a><a href="/tags/Tomcat/" style="font-size: 0.88rem;">Tomcat<sup>1</sup></a><a href="/tags/Yaml/" style="font-size: 0.88rem;">Yaml<sup>1</sup></a><a href="/tags/cron%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">cron表达式<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/" style="font-size: 0.88rem;">代码生成器<sup>1</sup></a><a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/" style="font-size: 0.88rem;">国际化<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>1</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6task/" style="font-size: 0.88rem;">定时task<sup>1</sup></a><a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">年度总结<sup>1</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5task/" style="font-size: 0.88rem;">异步task<sup>1</sup></a><a href="/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/" style="font-size: 0.88rem;">拦截器<sup>2</sup></a><a href="/tags/%E9%82%AE%E4%BB%B6task/" style="font-size: 0.88rem;">邮件task<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/6/2022 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2022 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 小东 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/6/2022 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "/img/down.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>